SELECT XMLQUERY('//countryId/text()' PASSING W.LOCATION RETURNING CONTENT).getStringVal() CountryId,
       XMLQUERY('//categoryName/text()' PASSING P.CATEGORY RETURNING CONTENT ).getStringVal() CategoryName,
       SUM(I.QUANTITY) quantity,
       COUNT(P.PRODUCT_ID) diff_products
FROM WAREHOUSES W
    JOIN INVENTORIES I on W.WAREHOUSE_ID = I.WAREHOUSE_ID
    JOIN PRODUCTS P on I.PRODUCT_ID = P.PRODUCT_ID
GROUP BY XMLQUERY('//countryId/text()' PASSING W.LOCATION RETURNING CONTENT).getStringVal(), XMLQUERY('//categoryName/text()' PASSING P.CATEGORY RETURNING CONTENT ).getStringVal();
